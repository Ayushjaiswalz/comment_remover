<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHP Comment Remover - Smart Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .upload-section {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }

        .upload-section:hover {
            border-color: #667eea;
            background: #f0f2ff;
        }

        .upload-section.dragover {
            border-color: #667eea;
            background: #e8f0ff;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4em;
            color: #667eea;
            margin-bottom: 20px;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .directory-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .directory-btn:hover {
            box-shadow: 0 10px 20px rgba(240, 147, 251, 0.3);
        }

        .file-list {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
            transition: background 0.2s ease;
        }

        .file-item:hover {
            background: #f8f9fa;
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-name {
            font-weight: 500;
            color: #333;
        }

        .file-size {
            color: #666;
            font-size: 0.9em;
        }

        .remove-file {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.2s ease;
        }

        .remove-file:hover {
            background: #c82333;
            transform: scale(1.1);
        }

        .options-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
        }

        .options-section h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .option-group {
            display: flex;
            align-items: center;
            margin: 15px 0;
        }

        .option-group label {
            margin-left: 10px;
            font-weight: 500;
            color: #555;
        }

        .checkbox {
            width: 18px;
            height: 18px;
            accent-color: #667eea;
        }

        .process-btn {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 30px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin: 20px 0;
        }

        .process-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(86, 171, 47, 0.3);
        }

        .process-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .progress-section {
            display: none;
            background: #e8f5e8;
            border: 1px solid #c3e6cb;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #56ab2f, #a8e6cf);
            width: 0%;
            transition: width 0.3s ease;
        }

        .status-text {
            color: #155724;
            font-weight: 500;
        }

        .results-section {
            display: none;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
        }

        .results-section h3 {
            color: #155724;
            margin-bottom: 15px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 5px;
            margin: 10px 0;
        }

        .download-btn {
            background: #007bff;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            font-size: 0.9em;
            transition: background 0.2s ease;
        }

        .download-btn:hover {
            background: #0056b3;
        }

        .error-section {
            display: none;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: #721c24;
        }

        .info-section {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: #0c5460;
        }

        .info-section h4 {
            margin-bottom: 10px;
        }

        .info-section ul {
            margin-left: 20px;
        }

        .info-section li {
            margin: 5px 0;
        }

        .server-status {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .server-status.connected {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .server-status.disconnected {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß PHP Comment Remover</h1>
            <p>Intelligently remove comments while preserving useful documentation</p>
        </div>

        <div class="main-content">
            <div class="server-status" id="serverStatus">
                <span id="statusText">üîç Checking server connection...</span>
            </div>

            <div class="upload-section" id="uploadSection">
                <div class="upload-icon">üìÅ</div>
                <h2>Select Files or Directory</h2>
                <p>Drag and drop files here, or click the buttons below to browse</p>
                
                <input type="file" id="fileInput" class="file-input" multiple accept=".php,.html,.js,.css,.txt">
                <input type="file" id="directoryInput" class="file-input" webkitdirectory directory multiple>
                
                <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                    üìÑ Select Files
                </button>
                <button class="upload-btn directory-btn" onclick="document.getElementById('directoryInput').click()">
                    üìÅ Select Directory
                </button>
            </div>

            <div class="file-list" id="fileList" style="display: none;">
                <h3>Selected Files:</h3>
                <div id="fileItems"></div>
            </div>

            <div class="options-section">
                <h3>Processing Options</h3>
                <div class="option-group">
                    <input type="checkbox" id="keepSimpleComments" class="checkbox" checked>
                    <label for="keepSimpleComments">Keep simple descriptive comments (recommended)</label>
                </div>
                <div class="option-group">
                    <input type="checkbox" id="removeHtmlComments" class="checkbox" checked>
                    <label for="removeHtmlComments">Remove HTML comments ()</label>
                </div>
                <div class="option-group">
                    <input type="checkbox" id="removeMultilineComments" class="checkbox" checked>
                    <label for="removeMultilineComments">Remove multi-line comments ()</label>
                </div>
                <div class="option-group">
                    <input type="checkbox" id="removeCodeComments" class="checkbox" checked>
                    <label for="removeCodeComments">Remove comments with code characters (<>()[]{})</label>
                </div>
                <div class="option-group">
                    <input type="checkbox" id="cleanEmptyLines" class="checkbox" checked>
                    <label for="cleanEmptyLines">Clean up excessive empty lines</label>
                </div>
            </div>

            <button class="process-btn" id="processBtn" onclick="processFiles()" disabled>
                üöÄ Process Files
            </button>

            <div class="progress-section" id="progressSection">
                <h3>Processing Files...</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p class="status-text" id="statusText">Initializing...</p>
            </div>

            <div class="results-section" id="resultsSection">
                <h3>‚úÖ Processing Complete!</h3>
                <div id="resultItems"></div>
            </div>

            <div class="error-section" id="errorSection">
                <h3>‚ùå Error Occurred</h3>
                <p id="errorText"></p>
            </div>

            <div class="info-section">
                <h4>How It Works:</h4>
                <ul>
                    <li><strong>Smart Detection:</strong> Automatically identifies useful vs. decorative comments</li>
                    <li><strong>Preserves:</strong> Simple descriptive comments that explain functionality</li>
                    <li><strong>Removes:</strong> HTML comments, multi-line comments, and decorative separators</li>
                    <li><strong>Safe:</strong> Original files are never modified - new cleaned files are created</li>
                </ul>
                
                <h4>Supported File Types:</h4>
                <ul>
                    <li>PHP files (.php)</li>
                    <li>HTML files (.html, .htm)</li>
                    <li>JavaScript files (.js)</li>
                    <li>CSS files (.css)</li>
                    <li>Text files (.txt)</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        let selectedFiles = [];
        let currentFileIndex = 0;
        const API_BASE_URL = 'http:

// Check server connection on page load
        window.addEventListener('load', checkServerConnection);

// File input handlers
        document.getElementById('fileInput').addEventListener('change', handleFileSelect);
        document.getElementById('directoryInput').addEventListener('change', handleFileSelect);

// Drag and drop handlers
        const uploadSection = document.getElementById('uploadSection');
        uploadSection.addEventListener('dragover', handleDragOver);
        uploadSection.addEventListener('dragleave', handleDragLeave);
        uploadSection.addEventListener('drop', handleDrop);

        async function checkServerConnection() {
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                if (response.ok) {
                    updateServerStatus(true, '‚úÖ Server connected and ready');
                } else {
                    updateServerStatus(false, '‚ùå Server error');
                }
            } catch (error) {
                updateServerStatus(false, '‚ùå Cannot connect to server. Make sure the Python server is running.');
            }
        }

        function updateServerStatus(connected, message) {
            const statusDiv = document.getElementById('serverStatus');
            const statusText = document.getElementById('statusText');
            
            statusDiv.className = `server-status ${connected ? 'connected' : 'disconnected'}`;
            statusText.textContent = message;
            
            const processBtn = document.getElementById('processBtn');
            processBtn.disabled = !connected || selectedFiles.length === 0;
        }

        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            addFiles(files);
        }

        function handleDragOver(event) {
            event.preventDefault();
            uploadSection.classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.preventDefault();
            uploadSection.classList.remove('dragover');
        }

        function handleDrop(event) {
            event.preventDefault();
            uploadSection.classList.remove('dragover');
            
            const files = Array.from(event.dataTransfer.files);
            addFiles(files);
        }

        function addFiles(files) {
            files.forEach(file => {
                if (isValidFileType(file)) {
                    if (!selectedFiles.find(f => f.name === file.name && f.size === file.size)) {
                        selectedFiles.push(file);
                    }
                }
            });
            
            updateFileList();
            updateProcessButton();
        }

        function isValidFileType(file) {
            const validExtensions = ['.php', '.html', '.htm', '.js', '.css', '.txt'];
            const extension = file.name.toLowerCase().substring(file.name.lastIndexOf('.'));
            return validExtensions.includes(extension);
        }

        function updateFileList() {
            const fileList = document.getElementById('fileList');
            const fileItems = document.getElementById('fileItems');
            
            if (selectedFiles.length === 0) {
                fileList.style.display = 'none';
                return;
            }
            
            fileList.style.display = 'block';
            fileItems.innerHTML = '';
            
            selectedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div>
                        <div class="file-name">${file.name}</div>
                        <div class="file-size">${formatFileSize(file.size)}</div>
                    </div>
                    <button class="remove-file" onclick="removeFile(${index})">√ó</button>
                `;
                fileItems.appendChild(fileItem);
            });
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            updateFileList();
            updateProcessButton();
        }

        function updateProcessButton() {
            const processBtn = document.getElementById('processBtn');
            const serverStatus = document.getElementById('serverStatus');
            const isConnected = serverStatus.classList.contains('connected');
            processBtn.disabled = !isConnected || selectedFiles.length === 0;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        async function processFiles() {
            if (selectedFiles.length === 0) return;

// Show progress section
            document.getElementById('progressSection').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('errorSection').style.display = 'none';

            const processBtn = document.getElementById('processBtn');
            processBtn.disabled = true;
            processBtn.textContent = '‚è≥ Processing...';

            try {
// Get processing options
                const options = {
                    keepSimpleComments: document.getElementById('keepSimpleComments').checked,
                    removeHtmlComments: document.getElementById('removeHtmlComments').checked,
                    removeMultilineComments: document.getElementById('removeMultilineComments').checked,
                    removeCodeComments: document.getElementById('removeCodeComments').checked,
                    cleanEmptyLines: document.getElementById('cleanEmptyLines').checked
                };

// Create FormData for file upload
                const formData = new FormData();
                selectedFiles.forEach(file => {
                    formData.append('files', file);
                });
                formData.append('options', JSON.stringify(options));

// Update progress
                updateProgress(0, 'Uploading files...');

// Send files to server
                const response = await fetch(`${API_BASE_URL}/process-files`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to process files');
                }

                updateProgress(100, 'Processing complete!');

                const result = await response.json();
                showResults(result.results);

            } catch (error) {
                showError(error.message);
            } finally {
                processBtn.disabled = false;
                processBtn.textContent = 'üöÄ Process Files';
                document.getElementById('progressSection').style.display = 'none';
            }
        }

        function updateProgress(percent, status) {
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('statusText').textContent = status;
        }

        function showResults(results) {
            const resultsSection = document.getElementById('resultsSection');
            const resultItems = document.getElementById('resultItems');
            
            resultItems.innerHTML = '';
            
            results.forEach(result => {
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                resultItem.innerHTML = `
                    <div>
                        <div><strong>${result.originalName}</strong> ‚Üí ${result.cleanedName}</div>
                        <div style="font-size: 0.9em; color: #666;">
                            ${formatFileSize(result.originalSize)} ‚Üí ${formatFileSize(result.cleanedSize)}
                        </div>
                    </div>
                    <a href="${API_BASE_URL}/download/${result.cleanedName}" class="download-btn" download>
                        üì• Download
                    </a>
                `;
                resultItems.appendChild(resultItem);
            });
            
            resultsSection.style.display = 'block';
        }

        function showError(message) {
            const errorSection = document.getElementById('errorSection');
            const errorText = document.getElementById('errorText');
            
            errorText.textContent = message;
            errorSection.style.display = 'block';
        }
    </script>
</body>
</html>